import { Client, Databases, ID } from 'node-appwrite';
import dotenv from 'dotenv';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
dotenv.config({ path: path.resolve(__dirname, '../.env.local') });

const client = new Client()
    .setEndpoint(process.env.NEXT_PUBLIC_APPWRITE_ENDPOINT)
    .setProject(process.env.NEXT_PUBLIC_APPWRITE_PROJECT_ID)
    .setKey(process.env.APPWRITE_API_KEY);

const databases = new Databases(client);

const DATABASE_ID = process.env.NEXT_PUBLIC_APPWRITE_DATABASE_ID;
const CHAPTERS_COLLECTION = process.env.NEXT_PUBLIC_APPWRITE_COLLECTION_CHAPTERS;
const QUESTIONS_COLLECTION = process.env.NEXT_PUBLIC_APPWRITE_COLLECTION_QUESTIONS || 'questions';

const tamilChapterData = {
    "unit": "2",
    "chapter_name": "роОрогрпНроХро│рпБроорпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИроХро│рпБроорпН",
    "total_questions": 15,
    "questions": [
        {
            "id": 1,
            "question": "ропрпВроХрпНро│ро┐роЯро┐ройрпН ро╡роХрпБродрпНродро▓рпН родрпБрогрпИродрпН родрпЗро▒рпНро▒родрпНродро┐ройрпН рокроЯро┐, a рооро▒рпНро▒рпБроорпН b роОройрпНро▒ рооро┐роХрпИ роорпБро┤рпБроХрпНроХро│рпБроХрпНроХрпБ, родройро┐родрпНрод рооро┐роХрпИ роорпБро┤рпБроХрпНроХро│рпН q рооро▒рпНро▒рпБроорпН r, a = bq + r роОройрпНро▒ро╡ро╛ро▒рпБ роЕроорпИропрпБрооро╛ройро╛ро▓рпН, роЗроЩрпНроХрпБ r роЖройродрпБ",
            "options": [
                "1 < r < b",
                "0 < r < b",
                "0 тЙд r < b",
                "0 < r тЙд b"
            ],
            "answer": "0 тЙд r < b"
        },
        {
            "id": 2,
            "question": "ропрпВроХрпНро│ро┐роЯро┐ройрпН ро╡роХрпБродрпНродро▓рпН родрпБрогрпИродрпН родрпЗро▒рпНро▒родрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐, роОроирпНрод рооро┐роХрпИ роорпБро┤рпБро╡ро┐ройрпН роХройродрпНродрпИропрпБроорпН 9роЖро▓рпН ро╡роХрпБроХрпНроХрпБроорпН рокрпЛродрпБ роХро┐роЯрпИроХрпНроХрпБроорпН роорпАродро┐роХро│рпН",
            "options": [
                "0, 1, 8",
                "1, 4, 8",
                "0, 1, 3",
                "1, 3, 5"
            ],
            "answer": "0, 1, 8"
        },
        {
            "id": 3,
            "question": "65 рооро▒рпНро▒рпБроорпН 117-ропро┐ройрпН роорпА.рокрпК.ро╡.-ро╡рпИ 65m - 117 роОройрпНро▒ ро╡роЯро┐ро╡ро┐ро▓рпН роОро┤рпБродрпБроорпНрокрпЛродрпБ m -ройрпН роородро┐рокрпНрокрпБ",
            "options": [
                "4",
                "2",
                "1",
                "3"
            ],
            "answer": "2"
        },
        {
            "id": 4,
            "question": "1729 -роР рокроХро╛роХрпН роХро╛ро░рогро┐рокрпНрокроЯрпБродрпНродрпБроорпН рокрпЛродрпБ, роЕроирпНродрокрпН рокроХро╛ роОрогрпНроХро│ро┐ройрпН роЕроЯрпБроХрпНроХрпБроХро│ро┐ройрпН роХрпВроЯрпБродро▓рпН",
            "options": [
                "1",
                "2",
                "3",
                "4"
            ],
            "answer": "3"
        },
        {
            "id": 5,
            "question": "1 роорпБродро▓рпН 10 ро╡ро░рпИропрпБро│рпНро│ (роЗро░рогрпНроЯрпБ роОрогрпНроХро│рпБроорпН роЙроЯрпНрокроЯ) роЕройрпИродрпНродрпБ роОрогрпНроХро│ро╛ро▓рпБроорпН ро╡роХрпБрокроЯрпБроорпН рооро┐роХроЪрпНроЪро┐ро▒ро┐роп роОрогрпН",
            "options": [
                "2025",
                "5220",
                "5025",
                "2520"
            ],
            "answer": "2520"
        },
        {
            "id": 6,
            "question": "7^(4k) тЙб ____ (роороЯрпНроЯрпБ 100)",
            "options": [
                "1",
                "2",
                "3",
                "4"
            ],
            "answer": "1"
        },
        {
            "id": 7,
            "question": "FтВБ = 1, FтВВ = 3 рооро▒рпНро▒рпБроорпН FтВЩ = FтВЩтВЛтВБ + FтВЩтВЛтВВ роОройроХрпН роХрпКроЯрпБроХрпНроХрокрпНрокроЯро┐ройрпН FтВЕ роЖройродрпБ",
            "options": [
                "3",
                "5",
                "8",
                "11"
            ],
            "answer": "11"
        },
        {
            "id": 8,
            "question": "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ройрпН роорпБродро▓рпН роЙро▒рпБрокрпНрокрпБ 1 рооро▒рпНро▒рпБроорпН рокрпКродрпБ ро╡ро┐родрпНродро┐ропро╛роЪроорпН 4 роОройро┐ро▓рпН, рокро┐ройрпНро╡ро░рпБроорпН роОрогрпНроХро│ро┐ро▓рпН роОродрпБ роЗроирпНродроХрпН роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ро▓рпН роЕроорпИропрпБроорпН?",
            "options": [
                "4551",
                "10091",
                "7881",
                "13531"
            ],
            "answer": "7881"
        },
        {
            "id": 9,
            "question": "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ройрпН 6-ро╡родрпБ роЙро▒рпБрокрпНрокро┐ройрпН 6 роороЯроЩрпНроХрпБроорпН, 7-ро╡родрпБ роЙро▒рпБрокрпНрокро┐ройрпН 7 роороЯроЩрпНроХрпБроорпН роЪроороорпН роОройро┐ро▓рпН, роЕроХрпНроХрпВроЯрпНроЯрпБродрпНродрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ройрпН 13-ро╡родрпБ роЙро▒рпБрокрпНрокрпБ",
            "options": [
                "0",
                "6",
                "7",
                "13"
            ],
            "answer": "0"
        },
        {
            "id": 10,
            "question": "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ро▓рпН 31 роЙро▒рпБрокрпНрокрпБроХро│рпН роЙро│рпНро│рой. роЕродройрпН 16-ро╡родрпБ роЙро▒рпБрокрпНрокрпБ m роОройро┐ро▓рпН, роЕроирпНродроХрпН роХрпВроЯрпНроЯрпБродрпНродрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ро▓рпН роЙро│рпНро│ роОро▓рпНро▓ро╛ роЙро▒рпБрокрпНрокрпБроХро│ро┐ройрпН роХрпВроЯрпБродро▓рпН",
            "options": [
                "16 m",
                "62 m",
                "31 m",
                "31/2 m"
            ],
            "answer": "31 m"
        },
        {
            "id": 11,
            "question": "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ро▓рпН роорпБродро▓рпН роЙро▒рпБрокрпНрокрпБ 1 рооро▒рпНро▒рпБроорпН рокрпКродрпБ ро╡ро┐родрпНродро┐ропро╛роЪроорпН 4. роЗроирпНродроХрпН роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ройрпН роОродрпНродройрпИ роЙро▒рпБрокрпНрокрпБроХро│рпИроХрпН роХрпВроЯрпНроЯро┐ройро╛ро▓рпН роЕродройрпН роХрпВроЯрпБродро▓рпН 120 роХро┐роЯрпИроХрпНроХрпБроорпН?",
            "options": [
                "6",
                "7",
                "8",
                "9"
            ],
            "answer": "8"
        },
        {
            "id": 12,
            "question": "A = 2тБ╢тБ╡ рооро▒рпНро▒рпБроорпН B = 2тБ╢тБ┤ + 2тБ╢┬│ + 2тБ╢┬▓ + .... + 2тБ░ роОройроХрпН роХрпКроЯрпБроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. рокро┐ройрпНро╡ро░рпБро╡ройро╡ро▒рпНро▒ро┐ро▓рпН роОродрпБ роЙрогрпНроорпИ?",
            "options": [
                "B роЖройродрпБ A -роР ро╡ро┐роЯ 2тБ╢тБ┤ роЕродро┐роХроорпН",
                "A рооро▒рпНро▒рпБроорпН B роЪроороорпН",
                "B роЖройродрпБ A -роР ро╡ро┐роЯ 1 роЕродро┐роХроорпН",
                "A роЖройродрпБ B-роР ро╡ро┐роЯ 1 роЕродро┐роХроорпН"
            ],
            "answer": "A роЖройродрпБ B-роР ро╡ро┐роЯ 1 роЕродро┐роХроорпН"
        },
        {
            "id": 13,
            "question": "3/16, 1/8, 1/12, 1/18, ... роОройрпНро▒ родрпКроЯро░рпНро╡ро░ро┐роЪрпИропро┐ройрпН роЕроЯрпБродрпНрод роЙро▒рпБрокрпНрокрпБ",
            "options": [
                "1/24",
                "1/27",
                "2/3",
                "1/81"
            ],
            "answer": "1/27"
        },
        {
            "id": 14,
            "question": "tтВБ, tтВВ, tтВГ, ... роОройрпНрокродрпБ роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИ роОройро┐ро▓рпН tтВЖ, tтВБтВВ, tтВБтВИ, ... роОройрпНрокродрпБ",
            "options": [
                "роТро░рпБ рокрпЖро░рпБроХрпНроХрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИ",
                "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИ",
                "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропрпБрооро▓рпНро▓, рокрпЖро░рпБроХрпНроХрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИропрпБрооро▓рпНро▓",
                "роТро░рпБ рооро╛ро▒ро┐ро▓ро┐родрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИ"
            ],
            "answer": "роТро░рпБ роХрпВроЯрпНроЯрпБродрпН родрпКроЯро░рпНро╡ро░ро┐роЪрпИ"
        },
        {
            "id": 15,
            "question": "(1┬│ + 2┬│ + 3┬│ + ... + 15┬│) - (1 + 2 + 3 + ... + 15) -ройрпН роородро┐рокрпНрокрпБ",
            "options": [
                "14400",
                "14200",
                "14280",
                "14520"
            ],
            "answer": "14280"
        }
    ]
};

async function main() {
    console.log(`Starting import of Chapter ${tamilChapterData.unit}: ${tamilChapterData.chapter_name}`);

    try {
        const chapter = await databases.createDocument(
            DATABASE_ID,
            CHAPTERS_COLLECTION,
            ID.unique(),
            {
                name: `роЕро▓роХрпБ ${tamilChapterData.unit}: ${tamilChapterData.chapter_name}`,
                description: tamilChapterData.chapter_name,
                color: "indigo-500", // Different color for distinction
                icon: "ЁЯФв", // Number icon relative to content
                medium: "tamil",
                questionCount: tamilChapterData.questions.length
            }
        );
        console.log(`тЬЕ Created chapter: ${chapter.name} (${chapter.$id})`);

        for (const q of tamilChapterData.questions) {
            const correctIndex = q.options.findIndex(opt => opt === q.answer);

            if (correctIndex === -1) {
                console.warn(`тЪая╕П  Warning: Answer "${q.answer}" not found in options for question ${q.id}. Defaulting to index 0.`);
            }

            await databases.createDocument(
                DATABASE_ID,
                QUESTIONS_COLLECTION,
                ID.unique(),
                {
                    chapterId: chapter.$id,
                    chapterName: chapter.name,
                    questionText: q.question,
                    options: q.options,
                    correctAnswer: correctIndex !== -1 ? correctIndex : 0,
                    createdBy: "admin",
                    createdAt: new Date().toISOString()
                }
            );
            console.log(`   - Added question ${q.id}`);
        }

        console.log(`\nSuccessfully imported chapter and ${tamilChapterData.questions.length} questions.`);

    } catch (error) {
        console.error("тЭМ Import failed:", error.message);
    }
}

main();
